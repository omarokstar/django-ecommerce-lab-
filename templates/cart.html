<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Cart | Nexus</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <style>
      :root {
        --primary: #2563eb;
        --primary-hover: #1d4ed8;
        --success: #10b981;
        --danger: #ef4444;
        --muted: #64748b;
        --light: #f8fafc;
        --dark: #1e293b;
        --border: #e2e8f0;
      }

      body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--light);
        color: var(--dark);
      }

      /* Navigation */
      .navbar {
        background-color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 1rem 0;
      }
      
      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--dark);
      }
      
      .navbar-brand i {
        color: var(--primary);
      }
      
      .nav-link {
        font-weight: 500;
        color: var(--dark);
        margin: 0 0.5rem;
        transition: all 0.3s ease;
      }
      
      .nav-link:hover {
        color: var(--primary);
      }
      
      .nav-link i {
        margin-right: 0.3rem;
      }
      
      .nav-link.active {
        color: var(--primary);
        font-weight: 600;
      }

      /* Cart Container */
      .cart-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .cart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .cart-title {
        font-weight: 600;
        font-size: 1.75rem;
        color: var(--dark);
        margin: 0;
      }

      .continue-shopping {
        display: flex;
        align-items: center;
        color: var(--primary);
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .continue-shopping:hover {
        color: var(--primary-hover);
      }

      .continue-shopping i {
        margin-right: 0.5rem;
      }

      /* Cart Layout */
      .cart-layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      @media (min-width: 992px) {
        .cart-layout {
          grid-template-columns: 2fr 1fr;
        }
      }

      /* Cart Items */
      .cart-items {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        padding: 1.5rem;
      }

      .cart-item {
        display: grid;
        grid-template-columns: 100px 1fr auto;
        gap: 1.5rem;
        padding: 1.5rem 0;
        border-bottom: 1px solid var(--border);
      }

      .cart-item:last-child {
        border-bottom: none;
      }

      .cart-item-img {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
      }

      .cart-item-details {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .cart-item-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dark);
      }

      .cart-item-category {
        font-size: 0.875rem;
        color: var(--muted);
        margin-bottom: 0.5rem;
      }

      .cart-item-price {
        font-weight: 600;
        color: var(--primary);
      }

      .cart-item-actions {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        justify-content: space-between;
      }

      .quantity-control {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .quantity-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--light);
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .quantity-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .quantity-value {
        min-width: 36px;
        text-align: center;
        font-weight: 500;
      }

      .remove-item {
        background: none;
        border: none;
        color: var(--danger);
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
      }

      .remove-item:hover {
        color: var(--danger);
        text-decoration: underline;
      }

      .remove-item i {
        margin-right: 0.25rem;
      }

      /* Cart Summary */
      .cart-summary {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        padding: 1.5rem;
        height: fit-content;
      }

      .summary-title {
        font-weight: 600;
        font-size: 1.25rem;
        margin-bottom: 1.5rem;
        color: var(--dark);
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
      }

      .summary-label {
        color: var(--muted);
      }

      .summary-value {
        font-weight: 500;
      }

      .summary-total {
        border-top: 1px solid var(--border);
        padding-top: 1rem;
        margin-top: 1rem;
        font-weight: 600;
        font-size: 1.125rem;
      }

      .total-price {
        color: var(--primary);
        font-size: 1.25rem;
      }

      .checkout-btn {
        width: 100%;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.75rem;
        font-weight: 600;
        margin-top: 1.5rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .checkout-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      }

      .checkout-btn i {
        margin-right: 0.5rem;
      }

      /* Empty Cart */
      .empty-cart {
        text-align: center;
        padding: 3rem 0;
        grid-column: 1 / -1;
      }

      .empty-cart-icon {
        font-size: 5rem;
        color: #e2e8f0;
        margin-bottom: 1.5rem;
      }

      .empty-cart-title {
        font-weight: 600;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: var(--dark);
      }

      .empty-cart-text {
        color: var(--muted);
        margin-bottom: 1.5rem;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Loading State */
      .cart-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 3rem 0;
        grid-column: 1 / -1;
      }

      .spinner {
        width: 3rem;
        height: 3rem;
        border: 4px solid rgba(37, 99, 235, 0.1);
        border-radius: 50%;
        border-top-color: var(--primary);
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* Messages */
      .cart-message {
        margin-top: 1.5rem;
        grid-column: 1 / -1;
      }

      /* Animations */
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive Adjustments */
      @media (max-width: 768px) {
        .cart-item {
          grid-template-columns: 80px 1fr;
          grid-template-rows: auto auto;
        }

        .cart-item-actions {
          grid-column: 1 / -1;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
          padding-top: 1rem;
          border-top: 1px dashed var(--border);
          margin-top: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="bi bi-box-seam me-2"></i>Nexus
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="bi bi-house me-1"></i>Home
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/products/">
                <i class="bi bi-grid me-1"></i>Shop
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/login/">
                <i class="bi bi-person me-1"></i>Login
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/register/">
                <i class="bi bi-person-plus me-1"></i>Register
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/cart/">
                <i class="bi bi-cart3 me-1"></i>Cart
                <span id="cartCount" class="badge bg-primary ms-1">0</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="cart-container">
      <div class="cart-header">
        <h1 class="cart-title">
          <i class="bi bi-cart3 me-2"></i>Your Shopping Cart
        </h1>
        <a href="/" class="continue-shopping">
          <i class="bi bi-arrow-left"></i> Continue Shopping
        </a>
      </div>

      <div class="cart-layout">
        <!-- Loading State -->
        <div id="cart-loading" class="cart-loading" style="display: none">
          <div class="spinner"></div>
        </div>

        <!-- Cart Items -->
        <div id="cart-items" class="cart-items"></div>

        <!-- Cart Summary -->
        <div id="cart-summary" class="cart-summary" style="display: none">
          <h3 class="summary-title">Order Summary</h3>
          <div class="summary-row">
            <span class="summary-label">Subtotal</span>
            <span id="subtotal" class="summary-value">$0.00</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Shipping</span>
            <span class="summary-value">Free</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Tax</span>
            <span id="tax" class="summary-value">$0.00</span>
          </div>
          <div class="summary-row summary-total">
            <span>Total</span>
            <span id="total" class="total-price">$0.00</span>
          </div>
          <button class="checkout-btn" onclick="checkout()">
            <i class="bi bi-credit-card me-2"></i>Proceed to Checkout
          </button>
        </div>

        <!-- Messages -->
        <div id="cartMsg" class="cart-message"></div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Mock cart data for demonstration
      const mockCartItems = [
        {
          id: 1,
          product: {
            id: 101,
            name: "Wireless Bluetooth Headphones",
            price: 129.99,
            image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&auto=format&fit=crop&q=60",
            category: "Electronics"
          },
          quantity: 1
        },
        {
          id: 2,
          product: {
            id: 102,
            name: "Organic Cotton T-Shirt",
            price: 24.99,
            image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&auto=format&fit=crop&q=60",
            category: "Clothing"
          },
          quantity: 2
        },
        {
          id: 3,
          product: {
            id: 103,
            name: "Stainless Steel Water Bottle",
            price: 19.99,
            image: "https://images.unsplash.com/photo-1602143407151-7111542de6e8?w=500&auto=format&fit=crop&q=60",
            category: "Home"
          },
          quantity: 1
        }
      ];

      async function loadCart() {
        const cartLoading = document.getElementById("cart-loading");
        const cartItemsContainer = document.getElementById("cart-items");
        const cartSummary = document.getElementById("cart-summary");
        
        cartLoading.style.display = "flex";
        cartItemsContainer.innerHTML = "";
        cartSummary.style.display = "none";

        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 800));

        const token = localStorage.getItem("access");
        if (!token) {
          cartLoading.style.display = "none";
          cartItemsContainer.innerHTML = `
            <div class="empty-cart fade-in">
              <i class="bi bi-person-lock empty-cart-icon"></i>
              <h3 class="empty-cart-title">Please login to view your cart</h3>
              <p class="empty-cart-text">Sign in to see your saved items and checkout</p>
              <a href="/login/" class="btn btn-primary">Login Now</a>
            </div>`;
          return;
        }

        try {
          // In a real app, you would fetch from your API:
          // const res = await fetch("/api/cart/", {
          //   headers: { Authorization: "Bearer " + token },
          // });
          // const data = await res.json();
          
          // For demo, we'll use mock data
          const data = mockCartItems;
          
          if (data.length === 0) {
            cartItemsContainer.innerHTML = `
              <div class="empty-cart fade-in">
                <i class="bi bi-cart-x empty-cart-icon"></i>
                <h3 class="empty-cart-title">Your cart is empty</h3>
                <p class="empty-cart-text">Browse our products and add items to get started</p>
                <a href="/" class="btn btn-primary">Shop Now</a>
              </div>`;
            return;
          }

          // Render cart items
          let html = '';
          let subtotal = 0;
          
          data.forEach(item => {
            const itemTotal = item.product.price * item.quantity;
            subtotal += itemTotal;
            
            html += `
              <div class="cart-item fade-in">
                <img src="${item.product.image}" alt="${item.product.name}" class="cart-item-img">
                <div class="cart-item-details">
                  <div>
                    <h4 class="cart-item-title">${item.product.name}</h4>
                    <div class="cart-item-category">${item.product.category}</div>
                    <div class="cart-item-price">$${item.product.price.toFixed(2)}</div>
                  </div>
                </div>
                <div class="cart-item-actions">
                  <div class="quantity-control">
                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">
                      <i class="bi bi-dash"></i>
                    </button>
                    <span class="quantity-value">${item.quantity}</span>
                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">
                      <i class="bi bi-plus"></i>
                    </button>
                  </div>
                  <button class="remove-item" onclick="removeFromCart(${item.id})">
                    <i class="bi bi-trash"></i> Remove
                  </button>
                </div>
              </div>`;
          });

          cartItemsContainer.innerHTML = html;
          
          // Update cart summary
          const tax = subtotal * 0.1; // 10% tax for demo
          const total = subtotal + tax;
          
          document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
          document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
          document.getElementById('total').textContent = `$${total.toFixed(2)}`;
          document.getElementById('cartCount').textContent = data.length;
          cartSummary.style.display = 'block';
          
        } catch (error) {
          cartItemsContainer.innerHTML = `
            <div class="alert alert-danger fade-in">
              <i class="bi bi-exclamation-triangle me-2"></i>${error.message || 'Failed to load cart'}
            </div>`;
        } finally {
          cartLoading.style.display = "none";
        }
      }

      async function updateQuantity(itemId, newQuantity) {
        if (newQuantity < 1) {
          removeFromCart(itemId);
          return;
        }

        const token = localStorage.getItem("access");
        if (!token) return;

        try {
          // In a real app, you would call your API:
          // const res = await fetch(`/api/cart/${itemId}/`, {
          //   method: "PATCH",
          //   headers: { 
          //     "Content-Type": "application/json",
          //     Authorization: "Bearer " + token 
          //   },
          //   body: JSON.stringify({ quantity: newQuantity })
          // });
          
          // For demo, we'll just reload the cart
          showToast('Quantity updated', 'success');
          await loadCart();
        } catch (error) {
          showToast('Failed to update quantity', 'error');
        }
      }

      async function removeFromCart(itemId) {
        const token = localStorage.getItem("access");
        if (!token) return;

        try {
          // In a real app, you would call your API:
          // const res = await fetch(`/api/cart/${itemId}/`, {
          //   method: "DELETE",
          //   headers: { Authorization: "Bearer " + token }
          // });
          
          // For demo, we'll just reload the cart
          showToast('Item removed from cart', 'success');
          await loadCart();
        } catch (error) {
          showToast('Failed to remove item', 'error');
        }
      }

      async function checkout() {
        const token = localStorage.getItem("access");
        if (!token) {
          showToast('Please login to checkout', 'warning');
          setTimeout(() => {
            window.location.href = "/login/";
          }, 1500);
          return;
        }

        try {
          // In a real app, you would call your API:
          // const res = await fetch("/api/orders/checkout/", {
          //   method: "POST",
          //   headers: { Authorization: "Bearer " + token }
          // });
          
          // For demo, we'll show a success message
          showToast('Order placed successfully!', 'success');
          setTimeout(() => {
            window.location.href = "/order-confirmation/";
          }, 2000);
        } catch (error) {
          showToast('Checkout failed. Please try again.', 'error');
        }
      }

      function showToast(message, type) {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type === 'error' ? 'danger' : type} fade-in`;
        toast.innerHTML = `
          <i class="bi ${type === 'success' ? 'bi-check-circle' : 'bi-exclamation-triangle'} me-2"></i>
          ${message}
        `;
        
        const cartMsg = document.getElementById('cartMsg');
        cartMsg.innerHTML = '';
        cartMsg.appendChild(toast);
        
        setTimeout(() => {
          toast.classList.remove('fade-in');
          toast.classList.add('fade-out');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', function() {
        loadCart();
      });
    </script>
  </body>
</html>